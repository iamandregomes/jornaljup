(function(a){a.fn.wpShowerSlider=function(e){if(this.length==0){return this}if(this.length>1){this.each(function(){a(this).wpShowerSlider(e)});return this}var u={el:this,can_transform:typeof(Modernizr)!="undefined"?Modernizr.csstransforms3d:false,is_mobile:(/iPhone|iPod|iPad|Android|BlackBerry/).test(navigator.userAgent),caption:false,override_links:false,total_thumbs:0,thumb_width:0,margin:0,first_visible:0,status:"none",current:0,all_thumbs:0,diff:0,bullets_container:"",video_container:"",video_content:"",video_margin:0,video_min_margin:0,video_status:"none"};u=a.extend(u,a.fn.wpShowerSlider.defaults,e);function m(){var C=u.thumbs;var D=0;for(D=0;D<C;D++){u.el.find("li:eq("+(u.total_thumbs-1)+")").clone().insertBefore(u.el.find("li:eq(0)"));u.margin-=u.thumb_width;u.first_visible++}C=C*2-1;if(u.bullets){var E=u.total_thumbs+u.thumbs-1;if(C<E){C=E}}for(D=0;D<C;D++){u.el.find("li:eq("+(u.first_visible+D)+")").clone().insertAfter(u.el.find("li:eq(-1)"))}}function x(C){var D={};if(C.hasOwnProperty("width")){D.width=C.width+"px"}if(C.hasOwnProperty("x")){if(u.can_transform&&(!u.video||u.video_images)){D.transform="translate("+C.x+"px, 0, 0)"}else{D.marginLeft=C.x+"px"}}if(C.hasOwnProperty("y")){if(u.can_transform){D.transform="translate(0, "+C.y+"px, 0)"}else{D.marginTop=C.y+"px"}}return D}function z(){u.bullets_container.find("span").removeClass("current");u.bullets_container.find("span:eq("+u.current+")").addClass("current")}function t(){u.video_content.find("span").removeClass("current");u.video_content.find("span:eq("+u.current+")").addClass("current")}function r(){if(u.caption){var C=u.el.find("li:eq("+u.first_visible+")").attr("data-caption");u.el.find(".caption").fadeOut(200,function(){a(this).text(C).fadeIn(200)})}}function B(){if(a(window).width()>u.tablet_width){u.video_min_margin=u.video_container.height()-u.video_content.height()-parseInt(u.video_content.css("marginTop"))-parseInt(u.video_content.css("marginBottom"));if(u.video_min_margin>0){u.video_min_margin=0}if(u.video_margin<u.video_min_margin){u.video_margin=u.video_min_margin;u.video_content.css(x({y:u.video_margin}))}}}function y(){var C=u.el.find("li:eq("+(u.first_visible+u.current)+") > article").height();if(u.thumbs>1){var E=0;for(var D=1;D<u.thumbs;D++){E=u.el.find("li:eq("+(u.first_visible+u.current+D)+") > article").height();if(E>C){C=E}}}u.el.find("ul").height(C);if(u.video){B()}}function q(){u.setThumbWidth();u.margin=-1*(u.first_visible+u.current)*u.thumb_width;u.el.find("li").css({width:u.thumb_width+"px"});u.el.find("ul").css(x({x:u.margin,width:u.thumb_width*u.all_thumbs}));y()}function A(){if(u.current>=u.total_thumbs){do{u.current-=u.total_thumbs;u.margin+=u.total_thumbs*u.thumb_width}while(u.current>=u.total_thumbs);u.el.find("ul").css(x({x:u.margin}))}else{if(u.current<0){do{u.current+=u.total_thumbs;u.margin-=u.total_thumbs*u.thumb_width}while(u.current<0);u.el.find("ul").css(x({x:u.margin}))}}if(u.bullets){z()}if(u.video){t()}u.status="none"}function l(){u.status="animate";y();if(u.can_transform&&(!u.video||u.video_images)){u.el.find("ul").transition({x:u.margin+"px"},u.duration,A)}else{u.el.find("ul").animate({marginLeft:u.margin+"px"},u.duration,A)}}function b(C){u.current+=C;r();u.margin-=u.thumb_width*C;l()}function n(D,C){D.preventDefault();D.stopPropagation();if(u.status=="none"){b(C)}else{if(u.status=="active"){u.el.off("mousemove touchmove");l()}}}function g(C){C.preventDefault();C.stopPropagation()}function f(D,C){u.page_x=D;u.page_y=C;u.lock="none"}function s(E,D,C){if(u.lock=="none"){u.diff=u.page_x-D;if(u.diff<0){u.diff*=-1}if(u.diff>=u.treshold){E.preventDefault();u.lock="x";u.status="active"}else{u.diff=u.page_y-C;if(u.diff<0){u.diff*=-1}if(u.diff>=u.treshold){u.lock="y";u.status="active"}}}if(u.lock=="x"){u.diff=u.page_x-D;if(u.video&&((u.current==0&&u.diff<0)||(u.current==u.all_thumbs-1&&u.diff>0))){u.diff=0}u.el.find("ul").css(x({x:u.margin-u.diff}))}}function k(D){D.preventDefault();u.el.off("mousemove touchmove");if(u.status=="active"){if(u.lock=="x"){if(u.diff>u.button_treshold||u.diff<-1*u.button_treshold){var C=u.diff>0?Math.ceil(u.diff/u.thumb_width):Math.floor(u.diff/u.thumb_width);b(C)}else{if(u.diff!=0){l()}else{u.status="none"}}}else{u.status="none"}u.diff=0}}function j(){if(u.status=="none"){u.status="button"}}function h(C){if(u.status=="button"){u.status="none"}else{C.preventDefault()}}function v(E,D){if(u.status!="none"){E.preventDefault();return}var C=D.index();if(C==u.first_visible){return}u.status="active";E.preventDefault();if(C<u.first_visible){b(-1)}else{b(1)}}function d(){u.video_status="none"}function o(){u.video_status="animate";if(u.can_transform){u.video_content.transition({y:u.video_margin+"px"},u.video_duration,d)}else{u.video_content.animate({marginTop:u.video_margin+"px"},u.video_duration,d)}}function p(C){if(u.video_status=="none"){var D=a(u.video_content_selector+" span:eq("+u.current+")");var E=u.video_margin-C*(D.height()+parseInt(D.css("marginTop")));if(E>0){E=0}else{if(E<u.video_min_margin){E=u.video_min_margin}}if(E==u.video_margin){return}u.video_margin=E;o()}}function c(){a(window).on("resize load",function(){q()});var C=u.is_mobile?"touchstart":"mouseup";var D=u.is_mobile?"touchend touchcancel":"mousedown";u.el.find(".prev").on(C,function(E){n(E,-1)}).on(D,function(E){g(E)});u.el.find(".next").on(C,function(E){n(E,1)}).on(D,function(E){g(E)});if(!u.is_mobile){u.el.on("mousedown",function(E){if(E.which!=1){return}E.preventDefault();if(u.status!="none"&&u.status!="button"){return}f(E.originalEvent.pageX,E.originalEvent.pageY);a(this).on("mousemove",function(F){s(F,F.originalEvent.pageX,F.originalEvent.pageY);if(u.lock=="y"){window.scrollBy(0,u.page_y-F.originalEvent.pageY)}})})}else{u.el.on("touchstart",function(E){if(u.status!="none"&&u.status!="button"){return}f(E.originalEvent.touches[0].pageX,E.originalEvent.touches[0].pageY);a(this).on("touchmove",function(F){s(F,F.originalEvent.touches[0].pageX,F.originalEvent.touches[0].pageY)})})}u.el.on("mouseup mouseleave touchend touchcancel",function(E){k(E)});u.el.find("a").on("mousedown touchstart",function(E){if(E.type=="mousedown"&&E.which!=1){return}j(E)});u.el.find("a").on("click",function(E){h(E)});if(u.bullets){u.bullets_container.find("span").click(function(){if(!u.status!="none"){u.status="active";var E=parseInt(a(this).attr("data-num"));if(E==u.current){u.status="none";return}if(E<u.current){E+=u.total_thumbs}E-=u.current;b(E)}})}if(u.override_links){u.el.find("li a").click(function(E){v(E,a(this).parent())})}if(u.video){a(u.video_selector+" .prev").on("click",function(E){p(-1)});a(u.video_selector+" .next").on("click",function(E){p(1)});a(u.video_content_selector+" > span").on("mousedown",function(G){G.preventDefault();var I=a(this).index();var E=parseInt(a(this).css("marginTop"));var F=a(this).height()-a(this).position().top;if(F>0){F=0}if(F>u.video_margin){u.video_margin=F;o()}var H=u.video_container_height-a(this).position().top-a(this).height()*2-E*4;if(H<u.video_min_margin){H=u.video_min_margin}if(H<u.video_margin){u.video_margin=H;o()}if(I!=u.current){b(I-u.current)}})}}function w(){if(u.video){u.video_container=a(u.video_selector);u.video_container_height=u.video_container.height()-u.video_container.find(".prev").height()*2;u.video_content_selector=u.video_selector+" .content";u.video_content=a(u.video_content_selector)}if(u.bullets){u.bullets_container=u.bullets_selector!=""?a(u.bullets_selector):u.bullets_container=u.el.find(".bullets")}u.total_thumbs=u.el.find("li").length;if(u.total_thumbs==0){return}u.setThumbWidth();if(!u.video){m()}u.all_thumbs=u.el.find("li").length;u.el.find("li").css({display:"block","float":"left",width:u.thumb_width+"px"});u.el.find("ul").css(x({width:u.thumb_width*u.all_thumbs,x:u.margin}));if(u.bullets){for(i=0;i<u.total_thumbs;i++){u.bullets_container.append('<span data-num="'+i+'">&#8226;</span>')}z()}r();c()}w();return this};a.fn.wpShowerSlider.defaults={thumbs:1,duration:300,treshold:9,button_treshold:50,thumb_separator:0,tablet_width:950,mobile_width:640,bullets:false,bullets_selector:"",setThumbWidth:function(){this.thumb_width=this.el.width();if(this.thumbs!=1){this.thumb_width=Math.floor((this.thumb_width+this.thumb_separator)/this.thumbs)}},video:false,video_images:false,video_selector:"",video_content_selector:"",video_duration:200}})(jQuery);